<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/black.css" id="theme">


        <div class="reveal" id="nnSlides">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1>Beat The Market</h1>
                    <br>
                    <p>Wouldn&apos;t it be wonderful if there was a program that could predict the future of the market? While knowing the future is impossible using history to make precise predictions based on the past is a reality.</p>
                </section>

                <section>
                    <h2>Problem Description</h2>
                    <br>
                    <p>The problem with the market is that if you put all of your money in and don’t make any moves you end up riding the ups and downs of the market and don’t end up with that great of a return on your investments. If there was a way that you could hedge those ups and downs so that you could hit the ups and miss the downs then you would be able to have much higher returns on your investments. </p>
                    <br>
                    <p>The program that I created attempts to beat the market average return from year to year.</p>
                </section>

                <section>
                    <h2>Why is the project interesting?</h2>
                    <br>
                    <p>This kind of a project has been attempted a ton. Financial institutions and investment companies have computer scientists who work on algorithms such as this full time and devote a lot of time and resources into finding better solutions. </p>
                    <br>
                    <p>It is a very high point of interest because it has the potential to help someone or a company make a lot of money.</p>
                </section>

           <!--     <section>
                    <h2>3</h2>
                </section> -->
            
                <section>
                    <section>
                        <h2>How to use the program.</h2>
                        <br>
                        <p>My program is a python program that runs within Quantopian&apos;s framework found on their website. </p>
                        <p>In order to run this program it must be done from <a href="http://www.quantopian.com" target="_blank">Quantopian’s website</a>.</p>
                        <br>
                        <p>Scroll down to see steps to run it</p>
                    </section>
                    <section>
                        <ol>
                            <li>Go to <a href="http://www.quantopian.com" target="_blank">Quantopian</a>.</li>
                            <li>You need to first register and create an account.</li>
                            <li>Go to the Algorithms page and create a new Algorithm.</li>
                            <li><a href="beatTheMarket.py" target="blank">Download</a>  the python code.
                            <li>Paste the code into the editor.</li>
                            <li>From this point you can modify the code or you can run additional backtests.</li>
                        </ol>
                        <br>
                        <p>I chose to use Quantopian because they provide a very easy to use platform for this type of problem. Gathering the data needed for my project could have been a lot more difficult but with Quantopian all of the data is already there to use.</p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>The Neural Network</h2>
                        <br>
                        <p>I built a neural network that looks at the price history for 1000&apos;s of stock tickers and attempts to predict the next period or days price for that ticker based on historically what it has done.</p>
                    </section>
                    <section>
                        <h4>Inputs</h4>
                        <ul>
                            <li>Features : This is comprised of the stock price for each day.</li>
                            <li>Label : if end_price > begin_price then label is 1 else it is -1</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Outputs</h4>
                        <ul>
                            <li>1  : Get in that day</li>
                            <li>0  : Neutral</li>
                            <li>-1 : Get out that day</li>
                        </ul>
                    </section>
                </section>



                <section>
                    <section>
                        <h2>Backtests</h2>
                        <br>
                        <p>I ran many different back tests attempting to optimize my algorithm. Some modifications helped it perfom better over certain stretches while others did the opposite.</p>
                    </section>
                    <section>
                    <h2>Backtest Results</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>BACKTEST DATE RANGE</th>
                                <th>FREQUENCY</th>
                                <th>BACKTEST OVERALL RETURN</th>
                                <th>STATUS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>8</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>104.49%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>7</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>92.12%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>6</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>70.63%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>5</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>0%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>4</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>113.31%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>-96.14%</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>-95.51</td>
                                <td>Completed</td>

                            </tr>
                            <tr>
                                <td>1</td>
                                <td>Nov 09 2003 - Nov 11 2015</td>
                                <td>Daily</td>
                                <td>-0.14</td>
                                <td>Completed</td>
                            </tr>
                        </tbody>
                    </table>
                    <br>
                    <p>My algorithm started off pretty bad but got better as I added different elements to it. One particular thing that I added was a 50 and 200 day moving average to filter what results my neural network produced.</p>
                </section>
                <section>
                    <h4>Full backtest (Nov 09 2003 to current date)</h4>
                    <img src="img/portfolio/full_backtest.jpg">
                    <p></p>
                </section>
                <section>
                    <img src="img/portfolio/2008-2009.jpg">
                    <br>
                    <p>Stretches where my algorithm did very well.</p>
                </section>                
                <section>
                    <img src="img/portfolio/2011-2012.jpg">
                    <br>
                    <p>Stretches where my algorithm did very poor.</p>
                </section>
            </section>






                <section>
                <h2>The Code</h2>
                <br>
                <pre><code class="hljs" data-trim contenteditable>
from sklearn.linear_model import LogisticRegression
from sklearn.svm import SVC, LinearSVC, NuSVC
from sklearn.ensemble import RandomForestClassifier
from sklearn import preprocessing
from collections import Counter
import numpy as np


def initialize(context):

context.stocks = symbols('XLY',  # XLY Consumer Discrectionary SPDR Fund   
                       'XLF',  # XLF Financial SPDR Fund  
                       'XLK',  # XLK Technology SPDR Fund  
                       'XLE',  # XLE Energy SPDR Fund  
                       'XLV',  # XLV Health Care SPRD Fund  
                       'XLI',  # XLI Industrial SPDR Fund  
                       'XLP',  # XLP Consumer Staples SPDR Fund   
                       'XLB',  # XLB Materials SPDR Fund  
                       'XLU')  # XLU Utilities SPRD Fund

context.historical_bars = 100
context.feature_window = 10



# *** handle_data ***
# 
# This function is run once per instance of the data. So if we run the program on daily
# data then it is run once per day.
def handle_data(context, data):
prices = history(bar_count = context.historical_bars, frequency='1d', field='price')

for stock in context.stocks:
    try:
        # create moving averages for 50 and 200 days to filter the results that we want
        # to get out of the nueral network.
        ma1 = data[stock].mavg(50)
        ma2 = data[stock].mavg(200)

        start_bar = context.feature_window
        price_list = prices[stock].tolist()

        X = []
        y = []

        bar = start_bar

        # feature creation
        # this is where I build out the Neural Network that 
        # learns from the history of the stocks.
        while bar &lt; len(price_list)-1:
            try:
                end_price = price_list[bar+1]
                begin_price = price_list[bar]

                pricing_list = []
                xx = 0
                for _ in range(context.feature_window):
                    price = price_list[bar-(context.feature_window-xx)]
                    pricing_list.append(price)
                    xx += 1

                features = np.around(np.diff(pricing_list) / pricing_list[:-1] * 100.0, 1)


                # print(features)

                if end_price > begin_price:
                    label = 1
                else:
                    label = -1

                bar += 1
                X.append(features)
                y.append(label)

            except Exception as e:
                bar += 1
                print(('feature creation',str(e)))




        clf1 = RandomForestClassifier()
        clf2 = LinearSVC()
        clf3 = NuSVC()
        clf4 = LogisticRegression()

        last_prices = price_list[-context.feature_window:]
        current_features = np.around(np.diff(last_prices) / last_prices[:-1] * 100.0, 1)

        X.append(current_features)
        X = preprocessing.scale(X)

        current_features = X[-1]
        X = X[:-1]

        clf1.fit(X,y)
        clf2.fit(X,y)
        clf3.fit(X,y)
        clf4.fit(X,y)

        p1 = clf1.predict(current_features)[0]
        p2 = clf2.predict(current_features)[0]
        p3 = clf3.predict(current_features)[0]
        p4 = clf4.predict(current_features)[0]
        
        
        if Counter([p1,p2,p3,p4]).most_common(1)[0][1] >= 4:
            p = Counter([p1,p2,p3,p4]).most_common(1)[0][0]
            
        else:
            p = 0
            
        print(('Prediction',p))


        if p == 1 and ma1 > ma2:
            order_target_percent(stock,0.33)
        elif p == -1 and ma1 &lt; ma2:
            order_target_percent(stock,-0.33)      

    except Exception as e:
        print(str(e))
        
        
record('ma1',ma1)
record('ma2',ma2)
record('Leverage',context.account.leverage)
                </code></pre>
                <br>
                <a class="btn btn-primary" href="beatTheMarket.py" target="blank"><i class="fa fa-download"></i> Download the Code</a>
                </section>




                <section>
                    <h3>Running your own backtests</h3>
                    <p>If you download the code and put it into Quantopian you can run your own backtests. Their platform is very nice and allows you to easily modify the data that you would like to backtest with.</p>
                    <p>Some of the metrics that you can change easily are: </p>
                    <ul>
                        <li>Daily or Minute data.</li>
                        <li>Starting investment amount.</li>
                        <li>Date ranges that you want to run the algorithm on.</li>
                    </ul>
                </section>



                <section>
                    <h3>In conclusion</h3>
                    <br>
                    <p>What I discovered by creating this algorithm is that it is very hard to predict what the market is going to do. My algorithm performed very well in some stretches and very poorly in others. Depending on what type of a year it was effected the performance of my algorithm. So one year it might be a good approach but others not so much.
                </section>









            </div>
        


        </div>




























<script src="js/reveal.js"></script>
    <script>

            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // Optional reveal.js plugins
                // dependencies: [
                //     { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                //     { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                //     { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                //     { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                //     { src: 'plugin/zoom-js/zoom.js', async: true },
                //     { src: 'plugin/notes/notes.js', async: true }
                // ]
            });

</script>